路由选择
---

当我们查询文档的时候，Elasticsearch 如何知道一个文档应该存放到哪个分片中呢？它

其实是通过下面这个公式来计算出来:

shard = hash(routing) % number_of_primary_shards

routing 默认值是文档的 id，也可以采用自定义值，比如用户 id。

不带 routing 查询
---

在查询的时候因为不知道要查询的数据具体在哪个分片上，所以整个过程分为 2 个步骤

 分发：请求到达协调节点后，协调节点将查询请求分发到每个分片上。

 聚合: 协调节点搜集到每个分片上查询结果，在将查询的结果进行排序，之后给用户返回结果。


带 routing 查询
---

查询的时候，可以直接根据 routing 信息定位到某个分配查询，不需要查询所有的分配，经

过协调节点排序。

向上面自定义的用户查询，如果 routing 设置为 userid 的话，就可以直接查询出数据来，

效率提升很多。


