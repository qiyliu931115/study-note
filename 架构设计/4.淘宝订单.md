美团的订单设计是最明显的用时间换空间，截止24年的时候 美团订单的性能上是最快的

淘宝的数据冗余小于美团的4份，但是性能赶不上美团的设计

有人问 是不是可以用sharding jdbc的复合分片 一份数据用多个key进行分片 例如用户ID和商家ID联合对一份数据进行分片

但是复合分片的前提是 两个或多个分片键后N位必须保持一致 用户ID以789结尾 商家ID也得用789结尾

08年淘宝就是单表单库 2010年发现数据查询插入速度下降

这个时间做的数据备份 三个月内的数据 留在数据库 三个月前的进行冷备份

2011年 数据增加非常 用户ID 订单ID 商家ID 查询本季度 本周售卖产品的

为了降低成本 历史数据存储到HBASE里面 列式存储 降低存储空间 但是HBASE有查询顺序的问题

第二 对于订单 没有像美团一样使用用户ID和商家ID进行分片

他们在订单表上层又创建了一张索引表

这个索引表 就是用户ID一个字段 第二个字段就是指向数据分片的位置

当在用户ID 查询时 找到用户ID的索引表 拿到当前用户ID数据的所在分片 再去查询真正的数据源

如果除了用户ID和数据的指向位置 我们可以把其他的字段添加进索引表 比如订单的生成时间 订单号 用户ID

这个思想 借鉴的是MySQL的辅助索引的覆盖索引特性

当时主数据使用订单ID进行分片 上面有一个用户ID的索引表和商家ID的索引表

那性能会比美团好吗

使用 用户ID 和商家ID 先过索引再到分片

用户索引和商家索引 一直维持到2024年

淘宝在阿里云做了一个polar dbx 2.0 直接对外卖产品 这个思想都在里面 叫 global index 全局二级索引

淘宝刚开始做数据分片的时候 淘宝当时定义叫 taobao database distribute layer TDDL

后来发现这个TDDL很好用 淘宝发现不仅通过裁员向社会输送人才 还可以通过现有的国内最顶尖的技术 创建阿里云 售卖技术

淘宝把TDDL 更名为DRDS: database relationship 关系型数据库 distribute service分布式服务 DRDS就这么商业化了

DRDS就是上面说到的 用户ID 商家ID 作为全局二级索引 并支持覆盖字段 需要的字段可以在二级索引 这就是覆盖索引

随后 DRDS 在售卖 比如说联通的呼叫中心就是用DRDS 阿里云的产品

后面淘宝改名叫polar dbx 2.0 新增了polar DB 兼容了MySQL  阿里自己搞了一个叫 X engine 存储引擎

X engine为什么要做呢 因为 2011年淘宝的历史数据在HBASE 存在顺序查询的问题 现在淘宝不想用HBASE

但是HBASE有一条压缩性 存储降低成本 所以淘宝自己研发了一个 X engine： 40%的压缩率

可以用X engine 存储历史数据 用MySQL innodb 搭建DRDS

这就是淘宝的订单存储 淘宝有elastic search吗 有的 进行数据检索聚合 业务部门 营销部门都需要用的






