offset存放位置
---
从0.9版本开始

consumer默认将offset存储在Kafka内置的一个topic中

该topic为

    _consumer_offsets

![img_93.png](img_93.png)

_consumer_offsets 采用key-value形式

key是group.id + topic + partition （消费者组id+主题+分区）

value是当前的offset

每隔一段时间 Kafka会对这个topic进行compact压缩， 

也就是每个group.id + topic + partition就保留最新数据

![img_95.png](img_95.png)

查看consumer_offsets
---

![img_96.png](img_96.png)

自动提交
---

enable.auto.commit默认true 是否开启自动提交功能

auto.commit.interval.ms 自动提交offset的时间间隔，默认5s


    // 自动提交
    properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG,true);

![img_97.png](img_97.png)

手动提交
---

手动提交分为两种

    commitSync(同步提交)和commitAsync(异步提交)

两者的相同点是

    都会提交本次数据最高的偏移量

不同的点是

    同步提交阻塞当前线程，一直到提交成功，自动失败重试

    异步提交 没有失败重试机制


