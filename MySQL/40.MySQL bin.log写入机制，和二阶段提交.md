写入机制
---

先写到bin log cache

每个事务都会分配一个 bin log cache

![img_420.png](img_420.png)

![img_419.png](img_419.png)

上图中的write是写到 内存的cache的

没有持久化到磁盘 速度是比较快 

上图中的fysnc 才将cache写到磁盘中的bin.log日志


![img_421.png](img_421.png)

write和fsync的时机有 sync_binlog 控制

默认是0 每次事务提交时只write 系统自动判断何时fsync

但是在fsync时 硬件故障会导致数据丢失

![img_422.png](img_422.png)

有一种折中的方案是 设置 一个N 每次提交都write 积累到N个事务后进行fsync

![img_423.png](img_423.png)

bin.log和redo.log的对比
---

redo log 属于物理日志，比如在某数据页某偏移量下写入或删除了某数据。 

是针对数据页内容，属于innoDB存储引擎的

而 bin log 和 undo log 记录的是逻辑日志 SQL的回滚和备份 里面是sql语法的内容

![img_424.png](img_424.png)