@GlobalTransactional是Seata分布式事务框架提供的注解，用于标注全局事务的入口，它具有以下原理：
---

1. 事务协调者：
        
   在Seata中，有一个全局事务协调者（Global Transaction Coordinator，简称GTC）， 它负责全局事务的协调和管理。

   @GlobalTransactional注解会在事务开始时，向GTC注册一个全局事务ID，并将该ID传递给所有涉及的分支事务。

2. 分支事务：
   
    在一个全局事务中，可能涉及多个分支事务，每个分支事务对应一个参与者（Participant），它负责自己的本地事务。

3. 分布式事务提交：

    当一个分支事务提交时，它会将事务执行结果（commit/rollback）通知给GTC，并将该结果持久化存储。

    当所有分支事务都提交时，GTC会判断全局事务的最终结果，并进行提交或回滚操作。

    如果其中任何一个分支事务失败，则会触发全局事务的回滚。

4. 分布式事务补偿：

    如果在全局事务提交之前，某个分支事务发生失败，GTC会通知所有分支事务进行回滚。

    在回滚时，Seata会调用参与者的回滚接口，执行相应的回滚操作，保证数据的一致性。

总之，@GlobalTransactional注解通过注册全局事务ID、协调和管理分支事务的提交和回滚，

以及进行分布式事务的补偿，实现了Seata的分布式事务功能。

如果分布式事务补偿时，回滚失败了怎么办？
---

如果在分布式事务补偿过程中，回滚操作失败了，Seata 提供了以下几种处理方式：

1. 重试补偿：

    Seata 会根据预定义的重试策略，对回滚操作进行重试，直到回滚成功或达到最大重试次数。

    如果回滚成功，则表示分布式事务最终回滚成功。如果达到最大重试次数，仍然无法回滚成功，则需要人工介入解决。

2. 人工介入：

    如果回滚操作重试多次仍然失败，需要人工介入解决。

    可以通过手动执行回滚操作，或者进行数据修复，将分支事务的数据恢复到回滚前的状态。

3. 分布式事务恢复：

    Seata 提供了分布式事务恢复的机制，可以通过分布式事务恢复服务进行手动恢复操作。

    具体操作可以参考Seata的官方文档，使用分布式事务恢复工具对失败的回滚进行处理。

需要注意的是，分布式事务补偿是一种应对异常情况的机制，应该尽量避免回滚操作失败的情况发生。

在设计分布式事务时，要充分考虑各种异常情况，保证数据操作的可靠性和一致性，避免分布式事务补偿操作的复杂性。


全局锁怎么实现的？
---
全局锁使用数据库表实现，lock_table。

为什么需要全局锁？
---
全局锁用于读写隔离，如果有多个分布式事务同时操作同一行数据库记录，那么可以保证数据的正确性。

lock_table什么时候插入记录，什么时候删除？
---
注册分支事务的时候会插入lock_table记录(正常情况)，全局事务提交的时候会删除lock_table。

读写隔离？
---

写隔离，如果要用分布式事务，那么对于同一张表更新时建议全使用@GlobalTransaction
读隔离，使用@GlobalTransactional+select for update 或者 @GlobalLock+@Transactional+select for update