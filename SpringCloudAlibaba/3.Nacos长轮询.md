nacos客户端采用长轮询机制每隔30秒拉取nacos配置信息
---

长轮询的原理
---
在上面长轮询的图中我们看到，客户端侧标注了一个timeout时间90s，

服务端最长的hold时间是80s，两个时间只是个示例，代表的是服务端hold的时间要小于客户端设置的超时时间。

这也很容易理解，如果服务端的hold时间大于客户端设置的超时时间，那么大概率客户端会出现timeout异常，这是非常不优雅的。

上节讲了，长轮询不可能一直占用tomcat的线程池，所以需要采用异步响应的方式去实现，

而比较方便实现异步http的方式就是Servlet3.0提供的AsyncContext 机制。

asyncContext是为了把主线程返回给tomcat线程池，不影响服务对其他客户端请求。

会有线程专门处理这个长轮询，但并不是说每一个长轮询的http请求都要用一个线程阻塞在那。而是把长轮询的request的引用在一个集合中存起来，用一个或几个线程专门处理一批客户端的长轮询请求，这样就不需要为每一个长轮询单独分配线程阻塞在那了，从而大大降低了资源的消耗，