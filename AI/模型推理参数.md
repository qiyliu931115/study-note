### Top-K （Top-K 采样）

**定义与作用**

    核心功能：在生成每个词时，仅保留概率最高的前 k 个候选词，其他词概率置零，然后从中采样。

**目的**：

    控制生成内容的相关性和多样性，避免选择低概率的无关词汇。

参数特点

**固定数量筛选：**

    无论概率分布如何，严格选择概率排名前 k 的词汇。
    例如 top_k=50，模型每步仅从概率最高的50个词中选择。

**适用场景**：

    需要确定性与可控性的任务（如问答、摘要）。
    若 k 值过小（如 k=1），生成可能过于保守（等价于贪婪搜索）；
    若 k 值过大（如 k=1000），可能引入噪声。

### Top_P 核采样，Nucleus Sampling

**定义与作用**

    核心功能：从累积概率超过阈值 p 的最小词汇集合中采样。

**目的**：

    动态适应概率分布，解决 top_k 在长尾分布下的不足，平衡生成质量与多样性。

**参数特点**

**动态筛选**：

    按概率从高到低累加，直到总和 ≥ p，仅保留这些词。
    例如 top_p=0.9，模型会选择累积概率达90%的最小词集。

**适应性强**：

    在尖锐分布（少数词概率高）时筛选严格；
    在平坦分布（多词概率接近）时放宽选择范围。
    与 top_k 的对比：
    top_p 更灵活，避免固定数量筛选可能导致的遗漏或冗余。

### temperature

**高温**（T > 1）：

    概率分布趋于平坦，多样性高，但可能生成不连贯内容。
    适合创意任务（如诗歌、故事）。

**低温**（T < 1）：

    概率分布趋于尖锐，确定性高，但可能重复或保守。
    适合事实性任务（如技术文档生成）。

**默认值**（T=1）：

    保持原始概率分布不变。

### 参数组合策略

**联合使用：**

    top_p + temperature 是常见组合，兼顾灵活性与可控性。

**典型配置：**

    创意生成：top_p=0.9, temperature=0.8
    事实性输出：top_p=0.5, temperature=0.3

**注意事项：**

    避免同时使用 top_k 和 top_p（可能过度限制候选集）。


### presence_penalty（存在惩罚）

**定义与作用**

    核心功能：对已出现过的 token（词或子词）施加固定惩罚值，降低其再次生成的概率。

**目的：**

    强制模型避免重复使用已生成的词汇，鼓励引入新内容，提升文本多样性。

**参数特点**

**无差别惩罚：**

    无论 token 出现多少次，只要出现过一次，惩罚值固定。
    例如，设置 presence_penalty=2.0，已出现的词每次被惩罚降低 2.0 的 logit。

**适用场景：**

    需要避免重复提及相同实体或概念（如生成故事时防止反复使用同一角色名）。
    生成技术文档时防止重复术语。

### frequency_penalty（频率惩罚）

**定义与作用**

    核心功能：对已出现过的 token 根据出现次数施加动态惩罚，出现次数越多，惩罚越强。

**目的：**

    抑制高频重复词汇，解决因模型偏好导致的机械性重复问题。

**参数特点**

**累积惩罚：**

    惩罚强度随重复次数线性增长，重复次数越多，后续生成概率越低。
    例如，设置 frequency_penalty=1.0，某词出现3次后，logit 会减少 3.0。

**适用场景**：

    抑制常见虚词或模板化表达（如“的”、“是”、“因此”）。
    避免生成重复句式（如“首先...其次...最后...”）


### 关键区别与选择策略

| 维度                | presence_penalty                | frequency_penalty               |
|---------------------|-------------------------------------|--------------------------------------|
| 惩罚对象        | 所有已出现过的词（无论次数）        | 已出现词的频率（次数越多，惩罚越强） |
| 惩罚强度        | 固定值（与次数无关）                | 动态值（随次数增加线性增强）         |
| 适用场景        | 避免重复引入相同概念                | 抑制高频词或模板化表达               |
| 典型值范围      | 0.0~2.0（过高可能导致语义混乱）     | 0.0~1.0（过高可能使文本不连贯）      |

